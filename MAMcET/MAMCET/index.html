<html>
 <head>
  <title>SIMPLE PENDULUM</title>

  <link rel="stylesheet" type="text/css" href="css/pendulum.css">
  <script type="text/javascript">
  
  function len1(){
  var pi=3.4;
  var g=9.8;
  var l=document.getElementById("length").value;
  var time=(2*pi)*(Math.sqrt(l/g))
  var freq = 1/time
  var omega = 2*pi*freq
  document.getElementById("result1").innerHTML=time.toFixed(3);
  document.getElementById("result2").innerHTML=freq.toFixed(3);
  document.getElementById("result3").innerHTML=omega.toFixed(3);
 }
 </script>
  
  <script type="text/javascript">
    
var Animation = function(canvasId) {
    this.canvas = document.getElementById(canvasId);
    this.context = this.canvas.getContext("2d");
    this.t = 0;
    this.timeInterval = 0;
    this.startTime = 0;
    this.lastTime = 0;
    this.frame = 0;
    this.animating = false;

	
	    // provided by Paul Irish
    window.requestAnimFrame = (function(callback) {
      return window.requestAnimationFrame
          || window.webkitRequestAnimationFrame
          || window.mozRequestAnimationFrame
          || window.oRequestAnimationFrame
          || window.msRequestAnimationFrame || function(callback) {
            window.setTimeout(callback, 1000 / 60);
          };
    })();
  };

  Animation.prototype.getContext = function() {
    return this.context;
  };

  Animation.prototype.getCanvas = function() {
    return this.canvas;
  };

  Animation.prototype.clear = function() {
    this.context.clearRect(0, 0, this.canvas.width, this.canvas.height);
  };

  Animation.prototype.setDrawStage = function(func) {
    this.drawStage = func;
  };

  Animation.prototype.getFrame = function() {
    return this.frame;
  };

  Animation.prototype.start = function() {
    this.animating = true;
    var date = new Date();
    this.startTime = date.getTime();
    this.lastTime = this.startTime;

    if (this.drawStage !== undefined) {
      this.drawStage();
    }

    this.animationLoop();
  };

  Animation.prototype.stop = function() {
    this.animating = false;
  };
  Animation.prototype.getTimeInterval = function() {
    return this.timeInterval;
  };

  Animation.prototype.getTime = function() {
    return this.t;
  };


  Animation.prototype.animationLoop = function() {
    var that = this;

    this.frame++;
    var date = new Date();
    var thisTime = date.getTime();
    this.timeInterval = thisTime - this.lastTime;
    this.t += this.timeInterval;
    this.lastTime = thisTime;

    if (this.drawStage !== undefined) {
      this.drawStage();
    }

    if (this.animating) {
      requestAnimFrame(function() {
        that.animationLoop();
      });
    }
  };
            window.onload=function(){
                var anim = new Animation("canvas_one");
                var canvas = anim.getCanvas();
                var context = anim.getContext();
                
                var amplitude = Math.PI / 4; // 45 degrees
                var period = 4000; // ms
                var theta = 0;
                var pendulumLength = 200;
                var pendulumWidth = 10;
                var rotationPointX = canvas.width / 2;
                var rotationPointY = 20;
                
                anim.setDrawStage(function(){
                    theta = (amplitude * Math.sin((2 * Math.PI * this.getTime()) / period)) + Math.PI / 2;
                    this.clear();

                    context.beginPath();
                    var endPointX = rotationPointX + (pendulumLength * Math.cos(theta));
                    var endPointY = rotationPointY + (pendulumLength * Math.sin(theta));
                    context.beginPath();
                    context.moveTo(rotationPointX, rotationPointY);
                    context.lineTo(endPointX, endPointY);
                    context.lineWidth = pendulumWidth;
                    context.strokeStyle = "black";
                    context.stroke();
                    
                    // draw bottom circle
                    context.beginPath();
                    context.arc(endPointX, endPointY, 40, 0, 2 * Math.PI, false);
                    var grd = context.createLinearGradient(endPointX - 50, endPointY - 50, endPointX + 50, endPointY + 50);
                    
                    grd.addColorStop(0, "#444");
                    grd.addColorStop(0.5, "gray");
                    grd.addColorStop(1, "#444");
                    context.fillStyle = grd;
                    context.fill();
                });
                

                anim.start();
            }; 
</script>
<script type="text/javascript">
        function showAxes(ctx,axes) {
            var width = ctx.canvas.width;
            var height = ctx.canvas.height;
            var xMin = 0;
            
            ctx.beginPath();
            ctx.strokeStyle = "rgb(128,128,128)";
            
            // X-Axis
            ctx.moveTo(xMin, height/2);
            ctx.lineTo(width, height/2);
            
            // Y-Axis
            ctx.moveTo(width/2, 0);
            ctx.lineTo(width/2, height);

            // Starting line
            ctx.moveTo(0, 0);
            ctx.lineTo(0, height);
            
            ctx.stroke();
        }
        function drawPoint(ctx, y) {            
            var radius = 3;
            ctx.beginPath();

            // Hold x constant at 4 so the point only moves up and down.
            ctx.arc(4, y, radius, 0, 2 * Math.PI, false);

            ctx.fillStyle = 'red';
            ctx.fill();
            ctx.lineWidth = 1;
            ctx.stroke();
        }
        function plotSine(ctx, xOffset, yOffset) {
            var width = ctx.canvas.width;
            var height = ctx.canvas.height;
            var scale = 20;

            ctx.beginPath();
            ctx.lineWidth = 2;
            ctx.strokeStyle = "rgb(66,44,255)";

            // console.log("Drawing point...");
            // drawPoint(ctx, yOffset+step);
            
            var x = 4;
            var y = 0;
            var amplitude;
            var frequency = 20;
            //ctx.moveTo(x, y);
            ctx.moveTo(x, 50);
			if ((document.getElementById("length").value >= 100) && (document.getElementById("length").value <= 120))
			{ amplitude =40;}
			else if ((document.getElementById("length").value >= 121) && (document.getElementById("length").value <= 140))
			{amplitude=70; }
			else
			{amplitude=100; }
            while (x < width) {
                y = height/2 + amplitude * Math.sin((x+xOffset)/frequency);
                ctx.lineTo(x, y);
                x++;
                // console.log("x="+x+" y="+y);
            }
            ctx.stroke();
            ctx.save();

            console.log("Drawing point at y=" + y);
            drawPoint(ctx, y);
            ctx.stroke();
            ctx.restore();
        }
        function draw() {
            var canvas = document.getElementById("canvas_two");
            var context = canvas.getContext("2d");

            context.clearRect(0, 0, 500, 500);
            showAxes(context);
            context.save();            
            
            plotSine(context, step, 50);
            context.restore();
            
            step += 4;
            window.requestAnimationFrame(draw);
        }
        function spirograph() {            
            var canvas2 = document.getElementById("canvas2");
            var context = canvas2.getContext("2d");
            
            showAxes(context);
            context.save();
            // var imageData = context.getImageData(0, 0, canvas.width, canvas.height);
            var step = 4; 
			for (var i = -4; i < canvas.height; i += step) {
                // context.putImageData(imageData, 0, 0);
                plotSine(context, i, 54 + i);
            }
        }
        function init1() {
            window.requestAnimationFrame(draw);
            spirograph();
        }
        var step = -4;
    </script> 
 </head>
 <body >
 <div id="header">SIMPLE PENDULUM</div>
<div>
 	<canvas id="canvas_one" width="500" height="400"></canvas>
	<canvas id="canvas_two" width="500" height="400"></canvas>
	</div>
	<div id="container" class="var">
   <form>
   <div id="divisiontitle">Variables :</div>
   <label for="length">Length(mm):</label>
   <input type="text" id="length" name="length">
   </form>
	</div>
	
	<div id="container" class="ctrl">
	<div id="divisiontitle"> Controls </div>
	<button value="Run" onClick="len1();init1()" id="Animation" > Start </button>
   	<button value="Stop" onClick="" id="Stopping"> Stop </button>
   	</div>
	
	<div class="res">
	<div id="divisiontitle"> Results </div>
	<p>The Time Period (t): 
	<span id = "result1"></span> sec
	</p>
	<p>The Natural frequency (rad/s): 
	<span id = "result2"></span> rad/sec
	</p>
	<p>The Natural frequency (Hz): 
	<span id = "result3"></span> Hz
	</p>
	</div>
	
   
  
 </body>
 </html>